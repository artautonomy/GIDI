import{s as C,c as W,b as O,a as L,t as T}from"../chunks/disclose-version.CyJLuhDn.js";import{p as R,q as D,a as X,k as Y,v as i,g as e,b as w,j as H,t as J,o as B,l as Q,m as U,f as V}from"../chunks/utils.CQdqtoc_.js";import{M as K,S as M,s as k}from"../chunks/store.2xqInZ_v.js";import{s as ee,a as te,w as se}from"../chunks/index.LDKbWZ8V.js";import{p as a,a as Z}from"../chunks/index-client.DzFwc65J.js";const oe=!0,fe=Object.freeze(Object.defineProperty({__proto__:null,prerender:oe},Symbol.toStringTag,{value:"Module"}));function ae(j,x){R(x,!0);const $=C(),r=()=>O(M,"$Settings",$);let l=D(a([])),s=D(a([])),n=D(a([])),f,b=[];X(()=>{r().remap&&(i(s,a([])),i(n,a([])),i(l,a([])),K.set(e(l)),W(M,w(r).remap=!1,w(r))),r().styleReset&&(r().scene!=="Piano"?(e(n).length<1&&i(n,a([...e(n),{note:e(l)[0].note,velocity:e(l)[0].velocity,position:{x:e(n).length,y:0,z:0},scale:{x:1,y:1,z:1}}])),i(l,a(e(n)))):i(l,a(e(s))),K.set(e(l)),W(M,w(r).styleReset=!1,w(r)))});const N=p=>{if(p.data){const c=p.data[1],S=p.data[2];let A;if(r().scene!=="Piano"?A=e(n).some(o=>o.note===c):A=e(s).some(o=>o.note===c),A)r().scene!=="Piano"?i(n,a(e(n).map(o=>o.note===c?{note:c,velocity:S,position:{x:o.position.x,y:o.position.y,z:o.position.z},scale:{x:o.scale.x,y:o.scale.y,z:o.scale.z}}:o))):i(s,a(e(s).map(o=>o.note===c?{note:c,velocity:S,position:{x:o.position.x,y:o.position.y,z:o.position.z},scale:{x:o.scale.x,y:o.scale.y,z:o.scale.z}}:o)));else if(r().scene!=="Piano")i(n,a([...e(n),{note:c,velocity:S,position:{x:e(n).length,y:0,z:0},scale:{x:1,y:1,z:1}}]));else{let o=0,v=0,u=1,d=1,g=1;const P=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];if(e(s).length<1){const m=P[c%12];e(s).some(z=>z.note===c)||(m.includes("#")?(o=.75,v=-.5,u=.5,d=.5,g=2):(o=0,v=-1,u=1,d=1,g=3),i(s,a([...e(s),{note:c,velocity:0,position:{x:e(s).length,y:o,z:0},scale:{x:u,y:d,z:g}}])))}else{const m=e(s)[0].note<c?e(s)[0].note:c,q=e(s)[e(s).length-1].note>c?e(s)[e(s).length-1].note-m:c-m;i(s,a([]));const z=P[m%12];let I,E=0,_=0;for(let t=0;t<=q;t++)P[(t+m)%12].includes("#")?(o=.75,v=-1.5,u=.5,d=.5,g=2):(o=0,v=-1,u=1,d=1,g=3),i(s,a([...e(s),{note:t+m,velocity:0,position:{x:t,y:o,z:v},scale:{x:u,y:d,z:g}}]));z.includes("#")&&(E=1);let y=e(s).filter(t=>t.scale.x===1),F=e(s).filter(t=>t.scale.x===.5);y=y.map((t,h)=>({note:t.note,velocity:t.velocity,position:{x:h+E,y:t.position.y,z:t.position.z},scale:{x:t.scale.x,y:t.scale.y,z:t.scale.z}})),F=F.map((t,h)=>(z.includes("#")?h===0?_=.5:(I=y.find(G=>G.note===t.note-1),_=I.position.x+.5):(I=y.find(G=>G.note===t.note-1),_=I.position.x+.5),{note:t.note,velocity:t.velocity,position:{x:_,y:t.position.y,z:t.position.z},scale:{x:t.scale.x,y:t.scale.y,z:t.scale.z}})),i(s,a([...y,...F])),i(s,a(e(s).toSorted((t,h)=>t.note-h.note)))}}r().scene!=="Piano"?i(l,a(e(n))):i(l,a(e(s))),K.set(e(l))}};Z(async()=>{if(navigator.requestMIDIAccess)try{f=await navigator.requestMIDIAccess(),b=Array.from(f.inputs.values()),b.forEach(p=>p.onmidimessage=N)}catch(p){console.error("Failed to get MIDI access",p)}else console.error("Web MIDI API not supported in this browser.")}),Y()}var ie=T('<!> <threlte class="svelte-12pb0e4"><!></threlte> <socials class="svelte-12pb0e4"><a href="https://github.com/artautonomy/GIDI" aria-label="github" class="svelte-12pb0e4"><img src="/socials/github.png" class="icons svelte-12pb0e4" alt="github"></a> <a href="https://www.paypal.com/paypalme/GIDIWebApp" aria-label="paypal" class="svelte-12pb0e4"><img src="/socials/paypal.png" class="icons svelte-12pb0e4" alt="paypal"></a> <a href="https://www.instagram.com/artautonomy" aria-label="instagram" class="svelte-12pb0e4"><img src="/socials/instagram.png" class="icons svelte-12pb0e4" alt="instagram"></a></socials>',1);function me(j,x){R(x,!0);const $=C(),r=()=>O(M,"$Settings",$);let l=D(!1);Z(()=>{i(l,!0)});var s=ie(),n=H(s);ae(n,{});var f=B(n,2),b=Q(f);k(b,()=>x.children),U(f);var N=B(f,2);const p=V(()=>`--opacity: ${(e(l)?1:0)??""}; --invert: ${(se(r().colours.background).isLight()?1:0)??""}`);J(()=>{ee(f,"display",e(l)?"block":"none"),te(N,"style",e(p))}),L(j,s),Y()}export{me as component,fe as universal};
